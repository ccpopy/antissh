# åé‡åŠ›ä»£ç†é…ç½®å·¥å…·

ä¸º åé‡åŠ› Agent é…ç½®ä»£ç†ï¼Œè§£å†³ç½‘ç»œè¿æ¥é—®é¢˜ã€‚

## ç³»ç»Ÿæ”¯æŒ

| ç³»ç»Ÿ        | æ”¯æŒæƒ…å†µ | è¯´æ˜                                                                          |
| ----------- | -------- | ----------------------------------------------------------------------------- |
| **Linux**   | æ”¯æŒ     | ä½¿ç”¨ graftcp è‡ªåŠ¨ä»£ç†ï¼ˆè„šæœ¬ä¸º Bashï¼Œéœ€ Bash >= 4ï¼‰                            |
| **macOS**   | ä¸æ”¯æŒ   | graftcp ä¾èµ– Linux çš„ `ptrace`ï¼Œæ¨èä½¿ç”¨ Proxifier æˆ– TUN æ¨¡å¼                |
| **Windows** | ä¸æ”¯æŒ   | æ¨èä½¿ç”¨ Proxifier æˆ– TUN æ¨¡å¼ æˆ– DLL æ³¨å…¥ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼›WSL å¯æŒ‰ Linux æ–¹å¼ä½¿ç”¨ |

## Linux ä½¿ç”¨æ–¹æ³•

### 1. ä¸‹è½½è„šæœ¬

```bash
curl -O https://raw.githubusercontent.com/ccpopy/antissh/main/antissh.sh
# æˆ–è€…å›½å†…åŠ é€Ÿä¸‹è½½
# curl -O https://ghproxy.net/https://raw.githubusercontent.com/ccpopy/antissh/main/antissh.sh
chmod +x antissh.sh
```

### 2. è¿è¡Œè„šæœ¬

```bash
bash ./antissh.sh
```

### 3. è„šæœ¬æ‰§è¡Œæµç¨‹

```mermaid
flowchart TD
    A[å¼€å§‹] --> B{æ£€æµ‹ç³»ç»Ÿ}
    B -->|Linux| C[è¯¢é—®ä»£ç†é…ç½®]
    B -->|macOS/Windows| Z1[æ˜¾ç¤ºæ›¿ä»£æ–¹æ¡ˆæç¤ºå¹¶é€€å‡º]

    C --> D{ç”¨æˆ·è¾“å…¥ä»£ç†åœ°å€}
    D -->|è·³è¿‡| Z2[é€€å‡ºè„šæœ¬]
    D -->|è¾“å…¥ä»£ç†| E[è§£æå¹¶æ ¡éªŒä»£ç†æ ¼å¼]

    E --> E1[é…ç½® graftcp-local ç«¯å£]
    E1 --> E2[é€‰æ‹© DNS è§£æç­–ç•¥]
    E2 --> F[è½»é‡çº§ä»£ç†æ¢æµ‹]
    F -->|æˆåŠŸ| G1[å¯¼å‡º HTTP_PROXY ç­‰ç¯å¢ƒå˜é‡]
    F -->|å¤±è´¥/è¶…æ—¶| G2[ç»§ç»­ä½¿ç”¨é•œåƒä¸‹è½½ç­–ç•¥]

    G1 --> H[æ£€æŸ¥/å®‰è£…ä¾èµ–]
    G2 --> H

    H --> I{GRAFTCP_DIR ç¯å¢ƒå˜é‡?}
    I -->|å·²è®¾ç½®ä¸”æœ‰æ•ˆ| J1[è·³è¿‡ç¼–è¯‘ï¼Œä½¿ç”¨ç°æœ‰ graftcp]
    I -->|æœªè®¾ç½®| J2{æœ¬åœ°å·²æœ‰ graftcp?}

    J2 -->|æ˜¯| J1
    J2 -->|å¦| K[å…‹éš† graftcp ä»“åº“]

    K --> L[ç¼–è¯‘ graftcp]
    L -->|æˆåŠŸ| M[æŸ¥æ‰¾ language_server]
    L -->|å¤±è´¥| Z3[æ˜¾ç¤ºæ‰‹åŠ¨å®‰è£…æŒ‡å¼•å¹¶é€€å‡º]

    J1 --> M
    M --> N[å¤‡ä»½åŸå§‹æ–‡ä»¶å¹¶ç”Ÿæˆ wrapper]
    N --> O[æµ‹è¯•ä»£ç†è¿é€šæ€§]
    O --> P[é…ç½®å®Œæˆ ğŸ‰]

    style A fill:#e1f5fe
    style P fill:#c8e6c9
    style Z1 fill:#fff3e0
    style Z2 fill:#fff3e0
    style Z3 fill:#ffebee
```

### 4. æŒ‰æç¤ºæ“ä½œ

è„šæœ¬ä¼šä¾æ¬¡ï¼š

- è¯¢é—®æ˜¯å¦éœ€è¦é…ç½®ä»£ç†
- è¾“å…¥ä»£ç†åœ°å€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
  - SOCKS5: `socks5://127.0.0.1:10808`
  - HTTP: `http://127.0.0.1:10808`
- é…ç½® graftcp-local ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 2233ï¼Œå¤šç”¨æˆ·ç¯å¢ƒå¯è‡ªå®šä¹‰ï¼‰
- é€‰æ‹© DNS è§£æç­–ç•¥ï¼ˆé»˜è®¤å¼ºåˆ¶ç³»ç»Ÿ DNSï¼‰
- è‡ªåŠ¨å®‰è£…ä¾èµ–å’Œç¼–è¯‘ graftcp
- è‡ªåŠ¨æŸ¥æ‰¾å¹¶é…ç½® language_server

### 5. ä¿®æ”¹ä»£ç†

ç›´æ¥é‡æ–°è¿è¡Œè„šæœ¬å³å¯æ›´æ–°ä»£ç†è®¾ç½®ã€‚

### 6. æ¢å¤åŸå§‹çŠ¶æ€

```bash
mv /path/to/language_server_xxx.bak /path/to/language_server_xxx
```

è·¯å¾„ä¼šåœ¨è„šæœ¬æ‰§è¡Œå®Œæˆåæ˜¾ç¤ºã€‚

### 7. å¤šç”¨æˆ·ç¯å¢ƒï¼ˆæœåŠ¡å™¨åœºæ™¯ï¼‰

graftcp-local æœåŠ¡éœ€è¦ç›‘å¬ä¸€ä¸ªæœ¬åœ°ç«¯å£ï¼ˆé»˜è®¤ 2233ï¼‰ã€‚åœ¨å¤šç”¨æˆ·å…±äº«æœåŠ¡å™¨ç¯å¢ƒä¸‹ï¼Œä¸åŒç”¨æˆ·éœ€è¦ä½¿ç”¨ä¸åŒçš„ç«¯å£ä»¥é¿å…å†²çªã€‚

è„šæœ¬ä¼šåœ¨è¿è¡Œæ—¶è¯¢é—®ç«¯å£é…ç½®ï¼š

```
è¯·è¾“å…¥ç«¯å£å·ï¼ˆé»˜è®¤ 2233ï¼Œç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤ï¼‰: 2234
```

- **ç›´æ¥å›è½¦**ï¼šä½¿ç”¨é»˜è®¤ç«¯å£ 2233
- **è¾“å…¥å…¶ä»–ç«¯å£**ï¼šä½¿ç”¨æŒ‡å®šçš„ç«¯å£ï¼ˆå¦‚ 2234ã€2235 ç­‰ï¼‰

ç«¯å£å†²çªå¤„ç†ï¼š

- å¦‚æœç«¯å£è¢«å…¶ä»– graftcp-local æœåŠ¡å ç”¨ â†’ å¤ç”¨è¯¥æœåŠ¡
- å¦‚æœç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨ â†’ æç¤ºé‡æ–°è¾“å…¥

---

## âš ï¸ IDE å‡çº§åä»£ç†å¤±æ•ˆé—®é¢˜

> [!WARNING]
> IDE å‡çº§åå¯èƒ½ä¼šåœ¨ `~/.antigravity-server/bin/` ä¸‹æ–°å¢ç‰ˆæœ¬ç›®å½•ï¼Œå¯¼è‡´ä¹‹å‰é…ç½®çš„ä»£ç†å¤±æ•ˆã€‚

### å¦‚ä½•è·å–æ–°ç‰ˆæœ¬å·

1. æ‰“å¼€ Antigravity å®¢æˆ·ç«¯
2. ç‚¹å‡» **Help â†’ About**
3. ç‚¹å‡» **Copy** æŒ‰é’®å¤åˆ¶ç‰ˆæœ¬ä¿¡æ¯
4. åœ¨å¤åˆ¶çš„ç‰ˆæœ¬ä¿¡æ¯ä¸­æ‰¾åˆ° `Electron: xxxxxxxxx...` è¿™ä¸€è¡Œï¼Œå…¶ä¸­çš„å“ˆå¸Œå€¼ï¼ˆå¦‚ `da3eb231fb10e6dc27750aa465b8582265c907d9`ï¼‰å³ä¸ºç‰ˆæœ¬å·

### è§£å†³æ–¹æ³•ï¼ˆäºŒé€‰ä¸€ï¼‰

**æ–¹æ³• 1ï¼šé‡æ–°è¿è¡Œè„šæœ¬ï¼ˆæ¨èï¼‰**

ç›´æ¥é‡æ–°è¿è¡Œ `antissh.sh`ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹æ–°ç›®å½•å¹¶é‡æ–°é…ç½®ã€‚

**æ–¹æ³• 2ï¼šæ‰‹åŠ¨è¿ç§»**

1. è¿›å…¥æ–°ç›®å½• `~/.antigravity-server/bin/<æ–°ç‰ˆæœ¬å·>/extensions/antigravity/bin/`
2. å°† `language_server_linux_*` é‡å‘½åä¸º `language_server_linux_*.bak`
3. å°†åŸç›®å½•ä¸­çš„ wrapper è„šæœ¬å¤åˆ¶åˆ°æ–°ç›®å½•

> [!TIP]
>
> - **ç«¯å£é…ç½®å¤ç”¨**ï¼šwrapper è„šæœ¬ä¸­ä¿å­˜äº†å®Œæ•´çš„é…ç½®ï¼ˆåŒ…æ‹¬ç«¯å£ï¼‰ï¼Œç›´æ¥å¤åˆ¶å³å¯ä¿æŒç«¯å£é…ç½®ä¸å˜
> - **é‡æ–°è¿è¡Œè„šæœ¬**ï¼šå¦‚æœé€‰æ‹©é‡æ–°è¿è¡Œè„šæœ¬ï¼Œéœ€è¦å†æ¬¡è¾“å…¥ç›¸åŒçš„ç«¯å£å·

### å¸¸è§é—®é¢˜ä¸æ’æŸ¥ï¼ˆWSL2 / ä»£ç†ï¼‰

æ ¹æ® issues æåŠåˆ°çš„ï¼Œä¸‹é¢æ˜¯ç›¸å…³è¯´æ˜ï¼š

- **.bak æ–‡ä»¶æ˜¯é¢„æœŸè¡Œä¸º**ï¼š`.bak` æ˜¯åŸå§‹äºŒè¿›åˆ¶ï¼Œ`language_server_*` ä¼šè¢« wrapper æ›¿æ¢ï¼›wrapper ä½¿ç”¨ `graftcp` å¯åŠ¨ `.bak`ï¼Œè¿™æ˜¯æ­£å¸¸æµç¨‹ã€‚
- **çœ‹åˆ° autoï¼ˆè‡ªåŠ¨è½¬å‘ï¼‰**ï¼šè„šæœ¬å¯åŠ¨ `graftcp-local` æ—¶ä½¿ç”¨ `-select_proxy_mode=only_*`ï¼Œç†è®ºä¸Šæ˜¯â€œç”¨æˆ·è½¬å‘â€ã€‚è‹¥å®é™…çœ‹åˆ° autoï¼Œå¤šåŠæ˜¯å¤ç”¨äº†æ—§çš„ `graftcp-local` è¿›ç¨‹æˆ–ç«¯å£ã€‚å»ºè®®å…ˆæ¸…ç†æ—§è¿›ç¨‹åé‡æ–°é…ç½®ã€‚
- **è„šæœ¬è¿è¡Œäº†ä½†è¿œç¨‹ä»åŠ è½½ä¸åˆ°æ¨¡å‹**ï¼šé€šå¸¸æ˜¯æœ¬åœ° IDE çš„ä»£ç†æœªæ­£å¸¸å·¥ä½œã€‚è¯·å…ˆç¡®ä¿æœ¬åœ° IDE èƒ½æ­£å¸¸åŠ è½½æ¨¡å‹ï¼Œå†åœ¨ WSL2 ä¸­è¿è¡Œè„šæœ¬å¹¶é‡æ–°è¿æ¥ã€‚
- **ç‰¹æ®Šç½‘ç»œçš„ DNS è§£æé—®é¢˜ï¼ˆSSH / WSL2ï¼‰**ï¼š
  - **SSH è¿œç¨‹**ï¼šæœ‰æ—¶ `curl` é€šè¿‡ä»£ç†è®¿é—® Google æ˜¯é€šçš„ï¼Œä½† `language_server` ä»æŠ¥ DNS é”™ã€‚åŸå› æ˜¯ `curl` å¯èƒ½ä¾èµ–ä»£ç†è§£æï¼ˆå¦‚ HTTP ä»£ç†æˆ– socks5hï¼‰ï¼Œè€Œå½“å‰ wrapper é»˜è®¤å¼ºåˆ¶ä½¿ç”¨ç³»ç»Ÿ DNSï¼ˆ`netdns=cgo`ï¼‰ï¼Œè¿™ä¸¤è€…å¹¶ä¸ç­‰ä»·ã€‚
  - **å»ºè®®**ï¼šå¦‚æœ `nslookup` æ­£å¸¸ä½†ç¨‹åºä»æŠ¥ DNS é—®é¢˜ï¼Œå¯åœ¨è„šæœ¬é‡Œé€‰æ‹©â€œä¸å¼ºåˆ¶ç³»ç»Ÿ DNSâ€ï¼Œå¹¶ç”±ä½ è‡ªå·±çš„ DNS æ–¹æ¡ˆï¼ˆå¦‚ smartdns / dnscrypt-proxyï¼‰æ¥ç®¡è§£æã€‚
  - **WSL2**ï¼šMirrored ç½‘ç»œæ¨¡å¼ä¸‹é€šå¸¸ä¸ä¼šé‡åˆ°è§£æ Google çš„é—®é¢˜ï¼Œä¸€èˆ¬æ— éœ€å…³é—­å¼ºåˆ¶ç³»ç»Ÿ DNSï¼›è‹¥ç¡®å®é‡åˆ°ç‰¹æ®Šç½‘ç»œé™åˆ¶ï¼Œå†æŒ‰ä¸Šé¢çš„æ–¹æ¡ˆå¤„ç†å³å¯ã€‚
  - ç›¸å…³è®¨è®ºï¼š[#27](https://github.com/ccpopy/antissh/issues/27)

**æ¸…ç†æ—§è¿›ç¨‹ï¼ˆæŒ‰éœ€æ‰§è¡Œï¼‰**

```bash
# å…ˆæŸ¥çœ‹å¯èƒ½æ®‹ç•™çš„è¿›ç¨‹
pgrep -a graftcp-local || true
pgrep -a language_server || true

# ç¡®è®¤æ— ç”¨åå†æ¸…ç†
pkill -f graftcp-local || true
pkill -f language_server || true
```

**æœ¬åœ° IDE ä»£ç†å»ºè®®ï¼ˆäºŒé€‰ä¸€å³å¯ï¼‰**

- Windows/macOS ä½¿ç”¨ Proxifier ä»£ç† IDE è¿›ç¨‹
- ä½¿ç”¨ä»£ç†çš„ TUN æ¨¡å¼

### WSL ç½‘ç»œé…ç½®ï¼ˆMirrored æ¨¡å¼ï¼‰

å¦‚æœä½ åœ¨ WSL ä¸­ä½¿ç”¨æœ¬è„šæœ¬ï¼Œå»ºè®®å¼€å¯ **Mirrored ç½‘ç»œæ¨¡å¼**ï¼Œè¿™æ · WSL å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ä»£ç†ï¼ˆ127.0.0.1ï¼‰ã€‚

**é…ç½®æ–¹æ³•ï¼š**

1. åœ¨ Windows ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºæˆ–ç¼–è¾‘ `.wslconfig` æ–‡ä»¶ï¼š

```ini
# %USERPROFILE%\.wslconfig
[wsl2]
networkingMode=mirrored
```

2. é‡å¯ WSLï¼š

```powershell
wsl --shutdown
```

3. é‡æ–°è¿›å…¥ WSL åï¼Œä»£ç†åœ°å€å¯ç›´æ¥ä½¿ç”¨ `127.0.0.1`ï¼š

```bash
# ä¾‹å¦‚ï¼Œv2rayNæ–°ç‰ˆæœ¬ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯æ··åˆç›‘å¬ç«¯å£ï¼š
socks5://127.0.0.1:10808
http://127.0.0.1:10808
```

> **æ³¨æ„**ï¼šMirrored æ¨¡å¼éœ€è¦ Windows 11 22H2 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œä¸” WSL ç‰ˆæœ¬ >= 2.0.0ã€‚
>
> å¦‚æœä¸ä½¿ç”¨ Mirrored æ¨¡å¼ï¼Œéœ€è¦ä½¿ç”¨ WSL è™šæ‹Ÿç½‘å¡çš„ç½‘å…³ IPï¼ˆé€šå¸¸æ˜¯ `cat /etc/resolv.conf` ä¸­çš„ nameserver åœ°å€ï¼‰ã€‚

---

## macOS / Windows æ›¿ä»£æ–¹æ¡ˆ

ç”±äº graftcp ä¾èµ– Linux çš„ `ptrace` ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ macOS/Windows ä¸Šæ— æ³•ä½¿ç”¨ã€‚

### æ¨èæ–¹æ¡ˆ 1ï¼šProxifierï¼ˆæ¨èï¼‰

1. ä¸‹è½½å®‰è£… [Proxifier](https://www.proxifier.com/)
   - å…³äº license keyï¼Œè¯·è‡ªè¡Œæœç´¢ï¼Œæœ‰ç‰¹åˆ«ç‰ˆåºåˆ—å·ï¼Œå¦‚æœ‰èƒ½åŠ›è¯·æ”¯æŒæ­£ç‰ˆ
2. æ·»åŠ ä»£ç†æœåŠ¡å™¨ï¼š
   - `Profile` â†’ `Proxy Servers` â†’ `Add`
   - å¡«å…¥ä½ çš„ä»£ç†åœ°å€
3. æ·»åŠ è§„åˆ™ï¼š`Profile` â†’ `Proxification Rules` â†’ `Add`
   - åº”ç”¨ç¨‹åºæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®ç³»ç»Ÿé€‰æ‹©ï¼‰ï¼š
     - macOS: `com.google.antigravity.helper; com.google.antigravity; Antigravity; language_server_macos_arm; language_server_macos_x64`
     - Windows: `language_server_windows_x64.exe; Antigravity.exe`
   - Action é€‰æ‹©åˆšæ·»åŠ çš„ä»£ç†

### æ¨èæ–¹æ¡ˆ 2ï¼šé€šè¿‡ DLL æ³¨å…¥ï¼ˆä»… Windows æ¨èï¼‰

å¦‚æœä¸æƒ³é€šè¿‡ TUN æ¨¡å¼æˆ–è€…ç¼–å†™ä»£ç†è§„åˆ™ï¼Œå¯ä»¥å‚è€ƒ [antigravity-proxy](https://github.com/yuaotian/antigravity-proxy)ï¼Œé€šè¿‡ DLL æ³¨å…¥ï¼Œä»…æ”¯æŒ Windowsã€‚

### æ¨èæ–¹æ¡ˆ 3ï¼šTUN æ¨¡å¼

ä½¿ç”¨ Clashã€Surge ç­‰å·¥å…·å¼€å¯ TUN æ¨¡å¼ï¼Œå®ç°å…¨å±€é€æ˜ä»£ç†ã€‚

### æ–¹æ¡ˆ 4ï¼šç¯å¢ƒå˜é‡ï¼ˆä¸æ¨èï¼‰

Agent æœåŠ¡å¯èƒ½æ— æ³•èµ°ä»£ç†ï¼Œä»…ä¾›å‚è€ƒï¼š

```bash
export ALL_PROXY=socks5://127.0.0.1:10808
export HTTPS_PROXY=http://127.0.0.1:10808
```

---

## Antigravity Server æ‰‹åŠ¨å®‰è£…è„šæœ¬

IDE ä¸€èˆ¬ä¼šåœ¨è¿œç¨‹è¿æ¥æ—¶ä¸‹è½½ä¸€ä¸ª.antigravity-server ç›®å½•ï¼Œå¦‚æœè¿œç¨‹æœåŠ¡å™¨æ— æ³•è‡ªåŠ¨ä¸‹è½½ Antigravity Serverï¼ˆå¦‚ç½‘ç»œå—é™ç¯å¢ƒï¼‰ï¼Œå¯ä½¿ç”¨ `installAntigravity.sh` è„šæœ¬æ‰‹åŠ¨å®‰è£…ã€‚

### ä¸‹è½½è„šæœ¬

```bash
curl -O https://raw.githubusercontent.com/ccpopy/antissh/main/installAntigravity.sh
# æˆ–è€…å›½å†…åŠ é€Ÿä¸‹è½½
# curl -O https://ghproxy.net/https://raw.githubusercontent.com/ccpopy/antissh/main/installAntigravity.sh
chmod +x installAntigravity.sh
```

### ä½¿ç”¨æ–¹æ³•

1. è¿è¡Œè„šæœ¬ï¼š`bash ./installAntigravity.sh`
2. æŒ‰æç¤ºä» Antigravity å®¢æˆ·ç«¯è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼š
   - æ‰“å¼€ Antigravity å®¢æˆ·ç«¯
   - ç‚¹å‡» **Help â†’ About**
   - ç‚¹å‡» **Copy** æŒ‰é’®
3. å°†å¤åˆ¶çš„ç‰ˆæœ¬ä¿¡æ¯ç²˜è´´åˆ°ç»ˆç«¯ï¼Œè¿ç»­æŒ‰ä¸¤æ¬¡å›è½¦
4. è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…å¯¹åº”ç‰ˆæœ¬

> [!NOTE]
> æ­¤è„šæœ¬ä¼šå°†ç»„ä»¶å®‰è£…åˆ° `~/.antigravity-server/bin/<commit-id>/` ç›®å½•ï¼Œä¸ IDE è‡ªåŠ¨ä¸‹è½½çš„è·¯å¾„ä¸€è‡´ã€‚

---

## ä¾èµ–è¦æ±‚

- **Go**: >= 1.13ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼‰
- **Git, Make, GCC**ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼‰

## é¸£è°¢

- [graftcp](https://github.com/hmgle/graftcp)
- [æ€è·¯æ¥æº](https://www.v2ex.com/t/1174113)

### ç‰¹åˆ«æ„Ÿè°¢

<a href="https://github.com/ccpopy/antissh/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=ccpopy/antissh" />
</a>

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=ccpopy/antissh&type=date&legend=top-left)](https://www.star-history.com/#ccpopy/antissh&type=date&legend=top-left)
